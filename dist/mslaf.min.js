/**
 * Laravel ajax forms 
 * @version 1.0.0
 * @author Mahmoud Sabry - 2018
 * @authorEmail mhsabry@yahoo.com
 * @license The MIT License (MIT)
 * @todo Ajax form in laravel
 * @todo Displying error/success validation messages
 */
!function(e){e.fn.mslaf=function(t){var n=this,a={},i={},s=!1,r=[],l=[],o=e.extend({url:"",method:"POST",singleAlert:!1,mainAlertDiv:"",errorDivClass:"",errorInputClass:"",successMessge:"Successfully done",successClass:"right",hidden:{},onDone:function(e){console.log("------- Done ---------")},onFail:function(e){console.log("------- Fail ---------")},onSubmit:function(e){console.log("------- submit ---------")},callback:function(e){console.log(e)}},t),u=function(t){a={};var n=[];if(n=t.find("button,textarea,select,input"),n.length>0)for(var i=0;i<n.length;i++)p(e(n[i]));if(!e.isEmptyObject(o.hidden))for(c=0;c<Object.keys(o.hidden).length;c++)a[Object.keys(o.hidden)[c]]=o.hidden[Object.keys(o.hidden)[c]];d(a)},d=function(t){r=Array.from(new Set(r)),l=Array.from(new Set(l));var n=""==o.url?i.attr("action"):o.url,a=o.method.toLowerCase();return""==n?void console.log('Missing form action or set {url:""}'):void e[a](n,t).done(function(e){s=!0,i.find('[type="submit"]').removeAttr("disabled"),m(o.successMessge),o.onDone&&"function"==typeof o.onDone&&o.onDone(e)}).fail(function(e){m(422==e.status?e.responseJSON:"Server error"),i.find('[type="submit"]').removeAttr("disabled"),o.onFail&&"function"==typeof o.onFail&&o.onFail(e)})};n.submit(function(t){t.preventDefault(),e(this).find('[type="submit"]').attr("disabled","disabled"),f(),o.onSubmit(),i=e(this),u(e(this))});var f=function(){e(document).find('[data-ms-alert="1"]').remove()},m=function(e){if("string"==typeof e)""==o.mainAlertDiv?(D(i.prev().data("ms-alert"))?i.prev().text(e):i.before("<span data-ms-alert='1'>"+e+"</span>"),s?v(i.prev(),"successClass"):v(i.prev(),"errorDivClass")):D(o.mainAlertDiv)?(o.mainAlertDiv.html(e),s?v(o.mainAlertDiv,"successClass"):v(o.mainAlertDiv,"errorDivClass")):console.log("Can't find main alert div");else if("object"==typeof e&&Object.keys(e).length>0){for(c=0;c<Object.keys(e).length;c++){if(catchInput=h(Object.keys(e)[c]),o.singleAlert===!0){if(0==c)var t="";t+=e[Object.keys(e)[c]]+"<br />"}else D(catchInput.next().data("ms-alert"))?catchInput.next().text(e[Object.keys(e)[c]]):catchInput.after("<span data-ms-alert='1'>"+e[Object.keys(e)[c]]+"</span>"),v(catchInput.next(),"errorDivClass");v(catchInput,"errorInputClass")}o.singleAlert===!0&&(D(o.mainAlertDiv)&&""!=o.mainAlertDiv?o.mainAlertDiv.attr("data-ms-alert","1").html(t):D(i.prev().data("ms-alert"))?i.prev().html(t):i.before("<span data-ms-alert='1'>"+t+"</span>"),v(i.prev(),"errorDivClass"))}o.callback&&"function"==typeof o.callback&&o.callback(e)},v=function(e,t){""!=o[t]&&e.addClass(o[t])},h=function(e){return-1!=r.indexOf(e)?i.find("[name^="+e+"]").last():-1!=l.indexOf(e)?i.find("[name="+e+"]").length>0?i.find("[name="+e+"]").last():i.find("[id="+e+"]").last():i.find("[name="+e+"]").length>0?i.find("[name="+e+"]"):i.find("[id="+e+"]")},p=function(e){D(e.attr("name"))?(newName=y(e.attr("name")))?(r.push(newName),D(a[newName])||(a[newName]=[]),(value=b(e,"name"))&&a[newName].push(value)):(value=b(e,"name"))&&(a[e.attr("name")]=value):D(e.attr("id"))&&(value=b(e,"id"))&&(a[e.attr("id")]=value)},b=function(e,t){switch(e.attr("type")){case"checkbox":e.is(":checked")?value=e.val():value=!1;break;case"radio":e.is(":checked")?value=e.val():value=!1,l.push(e.attr(t));break;case"select":e.is(":selected")&&(value=e.val());default:value=e.val()}return value},g=function(e){return"[]"===e.substring(e.length-2,e.length)?!0:!1},y=function(e){return g(e)?e.substring(0,e.length-2):!1},D=function(e){return"undefined"!=typeof e}}}(jQuery);
